(function($){'use strict';if(!$.nmThemeExtensions)
$.nmThemeExtensions={};function NmTheme(){var self=this;self.BREAKPOINT_LARGE=864;self.classWidgetPanelOpen='widget-panel-open';self.$window=$(window);self.$document=$(document);self.$html=$('html');self.$body=$('body');self.$widgetPanelOverlay=$('#jws-widget-panel-overlay');self.$header=$('#jws-header');self.$widgetPanel=$('.jws-cart-content');self.widgetPanelAnimSpeed=250;self.panelsAnimSpeed=200;self.init();self.bind()};NmTheme.prototype={init:function(){var self=this;self.widgetPanelPrep();self.loadExtension();if(self.$body.hasClass('jws-added-to-cart')){self.$body.removeClass('jws-added-to-cart')
self.$window.load(function(){if(self.$widgetPanel.length){self.widgetPanelShow(!0);setTimeout(function(){self.widgetPanelCartHideLoader()},1000)}})}},loadExtension:function(){var self=this;if($.nmThemeExtensions.singleProduct){$.nmThemeExtensions.singleProduct.call(self)}
if($.nmThemeExtensions.add_to_cart){$.nmThemeExtensions.add_to_cart.call(self)}
if($.nmThemeExtensions.infload){$.nmThemeExtensions.infload.call(self)}
if($.nmThemeExtensions.cart){$.nmThemeExtensions.cart.call(self)}},updateUrlParameter:function(uri,key,value){var i=uri.indexOf('#'),hash=i===-1?'':uri.substr(i);uri=(i===-1)?uri:uri.substr(0,i);var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=(uri.indexOf('?')!==-1)?"&":"?";if(uri.match(re)){uri=uri.replace(re,'$1'+key+"="+value+'$2')}else{uri=uri+separator+key+"="+value}
return uri+hash},bind:function(){var self=this;$('#jws-page-overlay, #jws-widget-panel-overlay , .close-cart ').on('click',function(){var $this=$(this);self.widgetPanelHide();$this.addClass('fade-out');setTimeout(function(){$this.removeClass('show fade-out')},self.panelsAnimSpeed)});if(self.$widgetPanel.length){self.widgetPanelBind()}},widgetPanelPrep:function(){var self=this;self.cartPanelAjax=null;self.quantityInputsBindButtons(self.$widgetPanel);self.$widgetPanel.on('blur','input.qty',function(){var $quantityInput=$(this),currentVal=parseFloat($quantityInput.val()),max=parseFloat($quantityInput.attr('max'));if(currentVal===''||currentVal==='NaN'){currentVal=0}
if(max==='NaN'){max=''}
if(currentVal>max){$quantityInput.val(max);currentVal=max};if(currentVal>0){self.widgetPanelCartUpdate($quantityInput)}});self.$document.on('nm_qty_change',function(event,quantityInput){self.widgetPanelCartUpdate($(quantityInput))})},widgetPanelBind:function(){var self=this;$('.cart-btn').on('click',function(e){e.preventDefault();self.$body.removeClass('.open-mobile-menu');self.widgetPanelShow()});$('.close-cart').on('click.close-cart',function(e){e.preventDefault();$('#jws-widget-panel-overlay').trigger('click')});self.$widgetPanel.on('click.close-cart','#jws-cart-panel-continue',function(e){e.preventDefault();$('#jws-widget-panel-overlay').trigger('click')});self.$widgetPanel.on('click','#jws-cart-panel .cart_list .remove',function(e){e.preventDefault();self.widgetPanelCartRemoveProduct(this)})},widgetPanelShow:function(showLoader){var self=this;if(showLoader){self.widgetPanelCartShowLoader()}
self.$body.addClass('widget-panel-opening '+self.classWidgetPanelOpen);self.$widgetPanelOverlay.addClass('show');setTimeout(function(){self.$body.removeClass('widget-panel-opening')},self.widgetPanelAnimSpeed)},widgetPanelHide:function(){var self=this;self.$body.addClass('widget-panel-closing');self.$body.removeClass(self.classWidgetPanelOpen);setTimeout(function(){self.$body.removeClass('widget-panel-closing')},self.widgetPanelAnimSpeed)},widgetPanelCartShowLoader:function(){$('#jws-cart-panel-loader').addClass('show')},widgetPanelCartHideLoader:function(){var self=this;$('#jws-cart-panel-loader').addClass('fade-out');setTimeout(function(){$('#jws-cart-panel-loader').removeClass('fade-out show')},200)},widgetPanelCartRemoveProduct:function(button){var self=this,$button=$(button),$itemLi=$button.closest('li'),$itemUl=$itemLi.parent('ul'),cartItemKey=$button.data('cart-item-key');$itemLi.closest('li').addClass('loading');self.cartPanelAjax=$.ajax({type:'POST',url:MS_Ajax.ajaxurl,data:{action:'nm_cart_panel_remove_product',cart_item_key:cartItemKey},dataType:'json',error:function(XMLHttpRequest,textStatus,errorThrown){console.log('NM: AJAX error - widgetPanelCartRemoveProduct() - '+errorThrown);$itemLi.closest('li').removeClass('loading')},complete:function(response){self.cartPanelAjax=null;var json=response.responseJSON;if(json&&json.status==='1'){$itemLi.css({'-webkit-transition':'0.2s opacity ease',transition:'0.2s opacity ease',opacity:'0'});setTimeout(function(){$itemLi.css('display','block').slideUp(150,function(){$itemLi.remove();var $cartLis=$itemUl.children('li');if($cartLis.length==1){$('#jws-cart-panel').addClass('jws-cart-panel-empty')}
self.shopReplaceFragments(json.fragments);self.$body.trigger('added_to_cart',[json.fragments,json.cart_hash])})},160)}else{console.log("NM: Couldn't remove product from cart")}}})},widgetPanelCartUpdate:function($quantityInput){var self=this;if(self.cartPanelAjax){self.cartPanelAjax.abort()}
$quantityInput.closest('li').addClass('loading');var data={action:'nm_cart_panel_update'};data[$quantityInput.attr('name')]=$quantityInput.val();self.cartPanelAjax=$.ajax({type:'POST',url:MS_Ajax.ajaxurl,data:data,dataType:'json',complete:function(response){var json=response.responseJSON;if(json&&json.status==='1'){self.shopReplaceFragments(json.fragments)}
$('#jws-cart-panel .cart_list').children('.loading').removeClass('loading')}})},shopReplaceFragments:function(fragments){var $fragment;$.each(fragments,function(selector,fragment){$fragment=$(fragment);if($fragment.length){$(selector).replaceWith($fragment)}})},quantityInputsBindButtons:function($container){var self=this;$container.off('click.nmQty').on('click.nmQty','.jws-qty-plus, .jws-qty-minus',function(){var $this=$(this),$qty=$this.closest('.quantity').find('.qty'),currentVal=parseFloat($qty.val()),max=parseFloat($qty.attr('max')),min=parseFloat($qty.attr('min')),step=$qty.attr('step');if(!currentVal||currentVal===''||currentVal==='NaN')currentVal=0;if(max===''||max==='NaN')max='';if(min===''||min==='NaN')min=0;if(step==='any'||step===''||step===undefined||parseFloat(step)==='NaN')step=1;if($this.hasClass('jws-qty-plus')){if(max&&(max==currentVal||currentVal>max)){$qty.val(max)}else{$qty.val(currentVal+parseFloat(step));self.quantityInputsTriggerEvents($qty)}}else{if(min&&(min==currentVal||currentVal<min)){$qty.val(min)}else if(currentVal>0){$qty.val(currentVal-parseFloat(step));self.quantityInputsTriggerEvents($qty)}}})},quantityInputsTriggerEvents:function($qty){var self=this;$qty.trigger('change');self.$document.trigger('nm_qty_change',$qty)},};$.nmTheme=NmTheme.prototype;$(document).ready(function(){new NmTheme()})})(jQuery)